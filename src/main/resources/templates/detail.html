<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ìƒì„¸ ì •ë³´ - SOOP ì•Œí”¼ì§€</title>
    <!-- ê·¸ë˜í”„ ê·¸ë¦¬ëŠ” JS ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/detail.css}">
</head>
<body>

<div class="container">
    <a href="/" class="btn-back">â† ë©”ì¸ ê±°ë˜ì†Œë¡œ ëŒì•„ê°€ê¸°</a>

    <div class="header">
        <div>
            <span class="live-badge">LIVE</span>
            <h1 style="margin: 5px 0;" th:text="${streamer.streamerName} + ' ì •ë³´'">ìŠ¤íŠ¸ë¦¬ë¨¸ ì´ë¦„</h1>
            <p style="color: #666;" th:text="${streamer.rankName} + ' ë“±ê¸‰'">ë“±ê¸‰</p>
        </div>
        <div style="text-align: right;">
            <p style="font-size: 0.9em; color: #888;">í˜„ì¬ê°€</p>
            <h2 style="color: #007bff; margin: 0;" th:text="${#numbers.formatInteger(streamer.currentPrice, 3, 'COMMA') + ' G'}">0 G</h2>
        </div>
    </div>

    <div class="info-grid">
        <div class="card">
            <h3>ğŸ“ˆ ì‹œê°ì  ë³€ë™ ì¶”ì´</h3>
            <div id="chart"></div> </div>
        <div class="card">
            <h3>ğŸ“Š ë°©ì†¡ í†µê³„</h3>
            <p>í˜„ì¬ ì‹œì²­ì: <strong th:text="${streamer.currentViewers}">0</strong> ëª…</p>
            <p>ì£¼ê°„ í‰ê·  ì‹œì²­ì: <strong th:text="${streamer.currentViewers}">0</strong> ëª… (ì¤€ë¹„ ì¤‘)</p>

            <div class="trade-box">
                <h4>ì£¼ì‹ ë§¤ìˆ˜í•˜ê¸°</h4>
                <div style="display: flex; gap: 10px;">
                    <input type="number" id="buyQuantity" value="1" min="1">
                    <button class="buy-btn" onclick="handleTrade('buy')">ë§¤ìˆ˜</button>
                </div>
                <div class="trade-box" style="background-color: #fff0f0; border: 1px solid #ffb2b2; margin-top: 15px;">
                    <h4>ì£¼ì‹ ë§¤ë„í•˜ê¸°</h4>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="sellQuantity" value="1" min="1">
                        <button class="buy-btn" style="background-color: #dc3545;" onclick="handleTrade('sell')">ë§¤ë„</button>
                    </div>
                </div>
                <p style="font-size: 0.8em; color: #555; margin-top: 10px;">
                    * ì´ ê²°ì œ ì˜ˆì • ê¸ˆì•¡: <span id="totalPrice" th:text="${streamer.currentPrice}">0</span> G
                </p>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/detail.js}"></script>

<script th:inline="javascript">
    /* íƒ€ì„ë¦¬í”„ ë°ì´í„°ë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë³€ìˆ˜ë¡œ ì•ˆì „í•˜ê²Œ ì „ë‹¬ */
    const historyData = /*[[${history}]]*/ [];
    const currentPrice = [[${streamer.currentPrice}]];
    const streamerId = [[${streamer.id}]];

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', function() {
        initChart(historyData);
        initPriceCalculator(currentPrice);
    });

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°ìš© ë˜í¼ í•¨ìˆ˜
    function handleTrade(type) {
        trade(type, streamerId);
    }
</script>

</body>
</html>